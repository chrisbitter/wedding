{% extends 'layout.html' %}
{% block page_content %}

<style>
    .btn-group {
        width: 100%;
    }

    .btn-group > .btn {
        width: 50%;
    }

    h1 {
        text-align: center;
    }


</style>

<div id="rsvp-app" class="align-self-center w-100">
    <h1>RSVP</h1>

    <!--div class="progress mb-2">
        <div class="progress-bar" role="progressbar" style="width: 0%;"
             aria-valuenow="100" aria-valuemin="0" aria-valuemax="100">0%
        </div>
    </div-->

    <!--Carousel Wrapper-->
    <div id="multi-item-example"
         class="carousel slide carousel-multi-item w-100 h-100"
         data-ride="carousel" data-interval="false">

        <div class="row">
            <div class="col-1 d-flex justify-content-center">
                <a class="btn-navigation btn-floating align-self-center"
                   href="#multi-item-example"
                   data-slide="prev"><i class="fas fa-chevron-left"></i></a>
            </div>


            <!--div class="col">
                <ol class="carousel-indicators">
                    <li v-for="(event, idx) in events" data-target="#multi-item-example" data-slide-to="{idx}"
                        :class="{'dot': true, 'dot_highlight': idx==0, 'active': idx==0}"></li>

                </ol>

            </div-->
            <div class="col">
                <!--Slides-->
                <div class="carousel-inner" role="listbox">

                    <!--Slide-->
                    <div v-for="(event, idx) in events"
                         :class="{'carousel-item': true, 'active': idx==0}">


                        <div class="card mb-1">
                            <div class="card-header"><h2>[[event.name]]</h2>
                            </div>
                            <div class="card-body">
                                <p>[[event.date]] | [[event.time]]</p>
                                <h5>[[event.description]]</h5>

                            </div>

                        </div>


                        <div v-for="guest in guests" class="card">
                            <div class="card-body">
                                <div class="container">

                                    <div class="row">
                                        <div class="col-8 d-flex justify-content-center">
                                            <h3 class="align-self-center">
                                                [[guest.name]]</h3>
                                        </div>

                                        <div class="col-4 d-flex justify-content-center">
                                            <div class="row align-self-center">
                                                <div class="col">
                                                    <div class="btn-group btn-group-toggle"
                                                         data-toggle="buttons">
                                                        <button v-on:click="choose_yes(guest.id, event.id)"
                                                                v-bind:class="{'btn':true, 'btn-secondary':true, 'btn-success':guest.rsvp[event.id]}">
                                                            <i class="fas fa-check fa-2x"></i>
                                                        </button>

                                                        <button v-on:click="choose_no(guest.id, event.id)"
                                                                v-bind:class="{'btn':true, 'btn-secondary':true, 'btn-danger':(!guest.rsvp[event.id] && guest.rsvp[event.id] != null)}">
                                                            <i class="fas fa-times fa-2x"></i>
                                                        </button>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="row">

                                        </div>
                                    </div>

                                </div>
                            </div>

                        </div>
                    </div>
                    <!--/.Slide-->

                </div>
                <!--/.Slides-->
            </div>
            <div class="col-1 d-flex justify-content-center">

                <a class="btn-navigation btn-floating align-self-center"
                   href="#multi-item-example"
                   data-slide="next"><i
                        class="fas fa-chevron-right"></i></a>
            </div>


        </div>
    </div>
    <!--/.Carousel Wrapper-->

    <!--

    <div id="carouselExampleIndicators" class="carousel slide h-100"
         data-ride="carousel">
        <ol class="carousel-indicators">
            <li data-target="#carouselExampleIndicators" data-slide-to="0"
                class="active"></li>
            <li data-target="#carouselExampleIndicators" data-slide-to="1"></li>
            <li data-target="#carouselExampleIndicators" data-slide-to="2"></li>
        </ol>
        <div class="carousel-inner">
            <div class="carousel-item active">



                <div class="card-holder">

                    <div v-for="guest in guests" class="card">
                        <div class="card-body">
                            <div class="container">

                                <div class="row">
                                    <div class="col-8">
                                        <h1>[[guest.name]]</h1>
                                    </div>

                                    <div class="col-4">
                                        <div class="row">
                                            <div class="col-6">
                                                <div class="btn-group btn-group-toggle"
                                                     data-toggle="buttons">
                                                    <button v-on:click="choose_yes(guest.id, event_id)"
                                                            v-bind:class="{'btn':true, 'btn-secondary':true, 'btn-success':guest.rsvp}">
                                                        <i class="fas fa-check fa-2x"></i>
                                                    </button>


                                                    <button v-on:click="choose_no(guest.id, event_id)"
                                                            v-bind:class="{'btn':true, 'btn-secondary':true, 'btn-danger':(!guest.rsvp && guest.rsvp != null)}">
                                                        <i class="fas fa-times fa-2x"></i>
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row">

                                    </div>
                                </div>

                            </div>
                        </div>

                    </div>

                </div>
                <div class="carousel-item">
                    <img class="d-block w-100" src="..." alt="Second slide">
                </div>
                <div class="carousel-item">
                    <img class="d-block w-100" src="..." alt="Third slide">
                </div>
            </div>
            <a class="carousel-control-prev" href="#carouselExampleIndicators"
               role="button" data-slide="prev">
                <span class="carousel-control-prev-icon"
                      aria-hidden="true"></span>
                <span class="sr-only">Previous</span>
            </a>
            <a class="carousel-control-next" href="#carouselExampleIndicators"
               role="button" data-slide="next">
                <span class="carousel-control-next-icon"
                      aria-hidden="true"></span>
                <span class="sr-only">Next</span>
            </a>
        </div>


    </div>

    -->
</div>

<script>

    new Vue({
        el: '#rsvp-app',
        data: {
            guests: [],
        },
        methods: {
            choose_yes: function (guest_id, event_id) {


                var self = this

                for (var ii = 0; ii < this.guests.length; ii++) {
                    if (this.guests[ii].id === guest_id) {

                        if (this.guests[ii].rsvp[event_id] !== true) {
                            $.post("/update_rsvp", {
                                "guest_id": guest_id,
                                "event_id": event_id,
                                "choice": true
                            }).done(function (data, status) {
                                self.guests[ii].rsvp[event_id] = true
                            });

                        }

                        break
                    }
                }
            },
            choose_no: function (guest_id, event_id) {

                var self = this

                for (var ii = 0; ii < this.guests.length; ii++) {
                    if (this.guests[ii].id === guest_id) {

                        if (this.guests[ii].rsvp[event_id] !== false) {

                            $.post("/update_rsvp", {
                                "guest_id": guest_id,
                                "event_id": event_id,
                                "choice": false
                            }).done(function (data, status) {
                                self.guests[ii].rsvp[event_id] = false
                            });
                        }
                        break
                    }
                }
            }
        },
        created: function () {
            // @formatter:off
            this.guests = {{ users | tojson }}
            this.events = {{ events_information | tojson }}
            // @formatter:on
        },
        delimiters: ["[[", "]]"]
    })
</script>

{% endblock page_content%}

